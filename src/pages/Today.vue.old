<template>
	<Layout>
		<h1 class="font-bold text-4xl">
			<g-link :to="today.previous">&lt;</g-link>
			{{today.month_full}} {{today.day_ordinal}}
			<g-link :to="today.next">&gt;</g-link>
		</h1>
		<div v-if="today">
			<Movie v-for="(event, index) in today.events" :key="index" :movie="event.movie" />
		</div>
	</Layout>
</template>

<page-query>
	{
		allDayofYear {
			edges {
				node {
					id
					month {
						id
						title
					}
					day {
						id
						ordinal
					}
					previous
					next
					events {
						id
						title
						info {
							wikipedia {
								url
							}
						}
						refreshments
						mention
						movie {
							id
							title
							plot
							director
							year
							images {
								poster {
									path
								}
							}
							studios {
								id
								title
								icon
							}
							genres {
								id
								title
								icon
							}
							countries {
								id
								title
								icon
							}
							languages {
								id
								title
								icon
							}
						}
					}
				}
			}
		}
	}
</page-query>

<script>
	import Movie from '@/components/MovieCard.vue';
	export default {
		components: {Movie},
		metaInfo: {
			title: 'Movies for Today',
		},
		data () {
			return {
				now: new Date(),
			};
		},
		created () {
			setInterval(() => this.now = new Date, 1000 * 60);
		},
		computed: {
			month() {
				return this.now.getMonth() + 1;
			},
			day() {
				return this.now.getDate();
			},
			today() {
				const today = this.$page.allDays.edges.find((date) => date.node.month === this.month && date.node.day === this.day);
				return today && today.node;
			}
		},
	};
</script>
